<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.yankuang.equipment.leasing.mapper.ElPlanMapper">
    <resultMap id="ElPlanMap" type="com.yankuang.equipment.leasing.model.ElPlan">
        <id column="plan_id" property="planId" jdbcType="VARCHAR" />
        <result column="plan_year" property="planYear" jdbcType="INTEGER" />
        <result column="plan_month" property="planMonth" jdbcType="INTEGER" />
        <result column="plan_quarter" property="planQuarter" jdbcType="INTEGER" />
        <result column="plan_position" property="planPosition" jdbcType="VARCHAR" />
        <result column="plan_remarks" property="planRemarks" jdbcType="VARCHAR" />
        <result column="plan_opinion" property="planOpinion" jdbcType="VARCHAR" />
        <result column="plan_creator_id" property="planCreatorId" jdbcType="VARCHAR" />
        <result column="plan_status" property="planStatus" jdbcType="VARCHAR" />
        <result column="plan_approve_time" property="planApproveTime" jdbcType="BIGINT" />
        <result column="plan_approver_id" property="planApproverId" jdbcType="VARCHAR" />
        <result column="plan_equipment_type" property="planEquipmentType" jdbcType="VARCHAR" />
        <result column="plan_type" property="planType" jdbcType="VARCHAR" />
        <result column="plan_is_del" property="planIsDel" jdbcType="BIT" />
        <result column="plan_create_time" property="planCreateTime" jdbcType="BIGINT" />
        <result column="plan_update_time" property="planUpdateTime" jdbcType="BIGINT" />
        <result column="plan_code" property="planCode" jdbcType="VARCHAR" />
        <result column="plan_updator_id" property="planUpdatorId" jdbcType="VARCHAR" />
        <result column="plan_sorting" property="planSorting" jdbcType="VARCHAR" />
        <result column="plan_version" property="planVersion" jdbcType="VARCHAR" />
        <collection property="elPlanItemList" javaType="Arraylist" ofType="com.yankuang.equipment.leasing.model.ElPlanItem" autoMapping="true" select="queryElPlanItemByPlanId" column="plan_id">
        </collection>
    </resultMap>

    <sql id="tb">
        el_plan
    </sql>

    <sql id="cols_all">
        plan_id, <include refid="cols_exclude_id" />
    </sql>

    <sql id="cols_exclude_id">
        plan_year, plan_month, plan_quarter, plan_position, plan_remarks,
    plan_opinion, plan_creator_id, plan_status, plan_approve_time, plan_approver_id, plan_equipment_type,
    plan_type, plan_is_del, plan_create_time, plan_update_time,plan_code,plan_updator_id,plan_sorting,plan_version

    </sql>

    <sql id="vals">
        #{planYear},
        #{planMonth},
        #{planQuarter},
        #{planPosition},
        #{planRemarks},
        #{planOpinion},
        #{planCreatorId},
        #{planStatus},
        #{planApproveTime},
        #{planApproverId},
        #{planEquipmentType},
        #{planType},
        #{planIsDel},
        #{planCreateTime},
        #{planUpdateTime},
        #{planCode},
        #{planUpdatorId},
        #{planSorting},
        #{planVersion}
    </sql>

    <sql id="criteria">

        <if test="planId != null" >
            AND plan_id = #{planId}
        </if>
        <if test="planYear != null" >
            AND plan_year = #{planYear}
        </if>
        <if test="planMonth != null" >
            AND plan_month = #{planMonth}
        </if>
        <if test="planQuarter != null" >
            AND plan_quarter = #{planQuarter}
        </if>
        <if test="planPosition != null" >
            AND plan_position = #{planPosition}
        </if>
        <if test="planRemarks != null" >
            AND plan_remarks = #{planRemarks}
        </if>
        <if test="planOpinion != null" >
            AND plan_opinion = #{planOpinion}
        </if>
        <if test="planCreatorId != null" >
            AND plan_creator_id = #{planCreatorId}
        </if>
        <if test="planStatus != null" >
            AND plan_status = #{planStatus}
        </if>
        <if test="planApproveTime != null" >
            AND plan_approve_time = #{planApproveTime}
        </if>
        <if test="planApproverId != null" >
            AND plan_approver_id = #{planApproverId}
        </if>
        <if test="planEquipmentType != null" >
            AND plan_equipment_type = #{planEquipmentType}
        </if>
        <if test="planType != null" >
            AND plan_type = #{planType}
        </if>
        <if test="planIsDel != null" >
            AND plan_is_del = #{planIsDel}
        </if>
        <if test="planCreateTime != null" >
            AND plan_create_time = #{planCreateTime}
        </if>
        <if test="planUpdateTime != null" >
            AND plan_update_time = #{planUpdateTime}
        </if>

        <if test="planCode != null" >
            AND plan_code = #{planCode}
        </if>
        <if test="planUpdatorId != null" >
            AND plan_updator_id = #{planUpdatorId}
        </if>
        <if test="planSorting != null" >
            AND plan_sorting = #{planSorting}
        </if>
        <if test="planVersion != null" >
            AND plan_version = #{planVersion}
        </if>
    </sql>

    <select id="queryElPlanItemByPlanId" resultType="com.yankuang.equipment.leasing.model.ElPlanItem" parameterType="String">
        SELECT * FROM el_plan_item WHERE plan_id = #{planId};
    </select>

    <insert id="create" parameterType="com.yankuang.equipment.leasing.model.ElPlan" keyProperty="planId" useGeneratedKeys="true">
        INSERT INTO <include refid="tb" />
        (<include refid="cols_exclude_id" />)
        VALUES
        (<include refid="vals" />)
    </insert>

    <select id="findById" parameterType="long" resultMap="ElPlanMap" >
        SELECT <include refid="cols_all" /> FROM <include refid="tb" />
        WHERE plan_id = #{plan_id} AND plan_is_del = 0
    </select>

    <select id="findByPrimarykey" parameterType="java.lang.String" resultMap="ElPlanMap" >
        SELECT <include refid="cols_all" /> FROM <include refid="tb" />
        WHERE plan_id = #{planId} AND plan_is_del = 0
    </select>

    <update id="update" parameterType="com.yankuang.equipment.leasing.model.ElPlan">
        UPDATE <include refid="tb"/>
        <set >
            <if test="planId != null" >
                plan_id = #{planId,jdbcType=VARCHAR},
            </if>
            <if test="planYear != null" >
                plan_year = #{planYear,jdbcType=INTEGER},
            </if>
            <if test="planMonth != null" >
                plan_month = #{planMonth,jdbcType=INTEGER},
            </if>
            <if test="planQuarter != null" >
                plan_quarter = #{planQuarter,jdbcType=INTEGER},
            </if>
            <if test="planPosition != null" >
                plan_position = #{planPosition,jdbcType=VARCHAR},
            </if>
            <if test="planRemarks != null" >
                plan_remarks = #{planRemarks,jdbcType=VARCHAR},
            </if>
            <if test="planOpinion != null" >
                plan_opinion = #{planOpinion,jdbcType=VARCHAR},
            </if>
            <if test="planCreatorId != null" >
                plan_creator_id = #{planCreatorId,jdbcType=VARCHAR},
            </if>
            <if test="planStatus != null" >
                plan_status = #{planStatus,jdbcType=VARCHAR},
            </if>
            <if test="planApproveTime != null" >
                plan_approve_time = #{planApproveTime,jdbcType=TIMESTAMP},
            </if>
            <if test="planApproverId != null" >
                plan_approver_id = #{planApproverId,jdbcType=VARCHAR},
            </if>
            <if test="planEquipmentType != null" >
                plan_equipment_type = #{planEquipmentType,jdbcType=VARCHAR},
            </if>
            <if test="planType != null" >
                plan_type = #{planType,jdbcType=VARCHAR},
            </if>
            <if test="planIsDel != null" >
                plan_is_del = #{planIsDel,jdbcType=BIT},
            </if>
            <if test="planCode != null" >
                plan_code = #{planCode,jdbcType=VARCHAR},
            </if>
            <if test="planUpdatorId != null" >
                plan_updator_id = #{planUpdatorId,jdbcType=VARCHAR},
            </if>
            <if test="planSorting != null" >
                plan_sorting = #{planSorting,jdbcType=VARCHAR},
            </if>
            <if test="planVersion != null" >
                plan_version = #{planVersion,jdbcType=VARCHAR},
            </if>
            plan_update_time = #{planUpdateTime,jdbcType=BIGINT}
        </set>
        WHERE plan_id = #{planId}
    </update>

    <delete id="delete" parameterType="long">
        DELETE FROM <include refid="tb"/>
        WHERE plan_id = #{planId}
    </delete>

    <select id="list" parameterType="map" resultMap="ElPlanMap">
        SELECT <include refid="cols_all"/> FROM <include refid="tb"/>
        <where>
            1 = 1 AND plan_is_del = 0
            <include refid="criteria"/>
        </where>
    </select>

    <select id="count" parameterType="map" resultType="long">
        SELECT count(1) FROM <include refid="tb"/>
        <where>
            1 = 1 AND plan_is_del = 0
            <include refid="criteria"/>
        </where>
    </select>

    <select id="paging" parameterType="map" resultMap="ElPlanMap">
        SELECT <include refid="cols_all"/> FROM <include refid="tb"/>
        <where>
            1 = 1 AND plan_is_del = 0
            <include refid="criteria"/>
        </where>
        order by created_at desc LIMIT #{offset}, #{limit}
    </select>

    <insert id="save">
        INSERT INTO <include refid="tb"/> (<include refid="cols_exclude_id" />) VALUES (<include refid="vals" />);
        INSERT INTO el_plan_item VALUES
        <foreach collection="elPlanItemList" item="item" separator=",">
            (#{item.itemId},#{planId},#{item.equipmentId},#{item.equipmentName},#{item.equipmentNum},#{item.itemPosition},#{item.itemEffect},
            #{item.equipmentBigType},#{item.equipmentMiddleType},#{item.equipmentSmallType},#{item.equipmentSpecification},#{item.equipmentParamName},#{item.equipmentParamValue},#{item.itemRemarks})
        </foreach>
        ;
    </insert>

    <delete id="deletePlanItemByPlanId" parameterType="java.lang.String">
        DELETE FROM el_plan_item
        WHERE plan_id = #{planId}
    </delete>

    <insert id="savePlanItemByPlanId">
        INSERT INTO el_plan_item VALUES
        <foreach collection="elPlanItemList" item="item" separator=",">
            (#{item.itemId},#{planId},#{item.equipmentId},#{item.equipmentName},#{item.equipmentNum},#{item.itemPosition},#{item.itemEffect},
            #{item.equipmentBigType},#{item.equipmentMiddleType},#{item.equipmentSmallType},#{item.equipmentSpecification},#{item.equipmentParamName},#{item.equipmentParamValue},#{item.itemRemarks})
        </foreach>
        ;
    </insert>

    <update id="deletePlanByPlanId" parameterType="java.lang.String">
        UPDATE <include refid="tb"/>
        <set > plan_is_del = 1 </set>
        WHERE plan_id = #{planId}
    </update>

</mapper>